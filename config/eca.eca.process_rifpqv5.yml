uuid: 00cec90a-5ec8-40ae-ad03-2e4559f01415
langcode: en
status: true
dependencies:
  config:
    - field.field.node.vacation.field_approve
    - field.field.node.vacation.field_numb_day
    - field.field.node.vacation.field_range
    - field.field.node.vacation.field_state_vacation
    - field.field.node.vacation.field_vacation_s_employee_
    - field.field.paragraph.person_who_approve.field_permission
    - field.field.paragraph.person_who_approve.field_person
    - field.storage.node.field_approve
    - field.storage.node.field_numb_day
    - field.storage.node.field_range
    - field.storage.node.field_state_vacation
    - field.storage.node.field_vacation_s_employee_
    - field.storage.paragraph.field_permission
    - field.storage.paragraph.field_person
    - node.type.vacation
    - paragraphs.paragraphs_type.person_who_approve
    - views.view.balance
  module:
    - eca_base
    - eca_content
    - eca_tamper
    - eca_user
    - eca_views
id: process_rifpqv5
modeller: bpmn_io
label: 'Approval system & Subtracting days'
version: v1
weight: -10
events:
  Event_1cytdr3:
    plugin: 'content_entity:insert'
    label: 'Insert paragraph'
    configuration:
      type: 'paragraph person_who_approve'
    successors:
      -
        id: Activity_1jd9bh0
        condition: ''
  Event_1pckq2l:
    plugin: 'content_entity:update'
    label: 'Update paragraph'
    configuration:
      type: 'paragraph person_who_approve'
    successors:
      -
        id: Activity_1nv7w3k
        condition: ''
  Event_1jpln7k:
    plugin: 'content_entity:insert'
    label: 'Insert vacation'
    configuration:
      type: 'node vacation'
    successors:
      -
        id: Activity_00ejyen
        condition: ''
  Event_1mkjlbs:
    plugin: 'content_entity:load'
    label: 'Load Vacation'
    configuration:
      type: 'node vacation'
    successors:
      -
        id: Activity_0innsk8
        condition: ''
conditions:
  Flow_1880gj1:
    plugin: eca_scalar
    configuration:
      case: false
      left: '[usercheck:field_person:entity:uid]'
      right: '[current-user:uid]'
      operator: equal
      type: value
      negate: true
  Flow_14scwzs:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[variable]'
      right: '[countitem]'
      operator: lessthan
      type: value
  Flow_0stapv6:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[paragraph:field_permission:value]'
      right: request_status_approved
      operator: equal
      type: value
  Flow_1niw684:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[countapprove]'
      right: '[countitem]'
      operator: equal
      type: value
  Flow_064ui2n:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[paragraph:field_permission:value]'
      right: request_status_rejected
      operator: equal
      type: value
  Flow_0x6ossg:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[variable]'
      right: '[countitem]'
      operator: lessthan
      type: value
  Flow_0bg0pzi:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[paragraph:field_permission:value]'
      right: request_status_on_hold
      operator: equal
      type: value
  Flow_18mpxzm:
    plugin: eca_entity_field_value
    configuration:
      negate: false
      case: false
      expected_value: '1'
      field_name: field_type_vacation.target_id
      operator: equal
      type: value
      entity: loadvac
gateways:
  Gateway_05pv8vu:
    type: 0
    successors:
      -
        id: Activity_0a8w5tr
        condition: Flow_14scwzs
      -
        id: Activity_0kr7hwe
        condition: Flow_1niw684
  Gateway_1sxe2lv:
    type: 0
    successors:
      -
        id: Activity_00yaic9
        condition: Flow_0stapv6
      -
        id: Activity_0ilmsz0
        condition: Flow_064ui2n
      -
        id: Activity_045gvlj
        condition: Flow_0bg0pzi
  Gateway_1vzq9rl:
    type: 0
    successors:
      -
        id: Activity_0gmm4si
        condition: Flow_0x6ossg
actions:
  Activity_1jd9bh0:
    plugin: eca_token_load_entity
    label: 'Load paragraph entity'
    configuration:
      token_name: state
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1gd1jm0
        condition: ''
  Activity_1gd1jm0:
    plugin: eca_set_field_value
    label: 'Set value [On-hold]'
    configuration:
      field_name: '[field_permission:value]'
      field_value: request_status_on_hold
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: state
    successors: {  }
  Activity_1nv7w3k:
    plugin: eca_token_load_entity
    label: 'Load paragraph entity'
    configuration:
      token_name: usercheck
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1b7b2n4
        condition: Flow_1880gj1
  Activity_1b7b2n4:
    plugin: eca_set_field_value
    label: 'Set value [On-hold]'
    configuration:
      field_name: '[field_permission:value]'
      field_value: request_status_on_hold
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: usercheck
    successors: {  }
  Activity_00ejyen:
    plugin: eca_token_load_entity
    label: 'Load vacation entity'
    configuration:
      token_name: vacation
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_0pj75s9
        condition: ''
  Activity_0pj75s9:
    plugin: eca_set_field_value
    label: 'Set state'
    configuration:
      field_name: '[field_state_vacation:value]'
      field_value: request_status_on_hold
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: vacation
    successors:
      -
        id: Activity_0ipphie
        condition: ''
  Activity_0a28vpb:
    plugin: 'eca_tamper:math'
    label: 'Calc Numb Day'
    configuration:
      operation: subtraction
      flip: false
      value: '[vacation:field_range:start_date:raw]'
      eca_data: '[vacation:field_range:end_date:raw]'
      eca_token_name: numb
    successors:
      -
        id: Activity_0pxpwwn
        condition: ''
  Activity_0n6kbzq:
    plugin: eca_set_field_value
    label: 'Set Numb Day'
    configuration:
      field_name: '[field_numb_day:value]'
      field_value: '[number]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: vacation
    successors: {  }
  Activity_0pxpwwn:
    plugin: 'eca_tamper:timetodate'
    label: 'Convert Unix to Day'
    configuration:
      date_format: d
      eca_data: '[numb]'
      eca_token_name: number
    successors:
      -
        id: Activity_0n6kbzq
        condition: ''
  Activity_0ipphie:
    plugin: eca_set_field_value
    label: 'Set Vacation''s Employee'
    configuration:
      field_name: '[field_vacation_s_employee_:target_id]'
      field_value: '[current-user:uid]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: vacation
    successors:
      -
        id: Activity_0a28vpb
        condition: ''
  Activity_0innsk8:
    plugin: eca_token_load_entity
    label: 'Load vacation entity'
    configuration:
      token_name: loadvac
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_16b0to0
        condition: ''
  Activity_18rbrxi:
    plugin: eca_count
    label: 'Count list listapprove [countitem]'
    configuration:
      token_name: countitem
      list_token: listapprove
    successors:
      -
        id: Activity_04ut7x3
        condition: ''
  Activity_16b0to0:
    plugin: eca_list_add_entity
    label: 'Create list field_approve [listapprove]'
    configuration:
      method: append
      index: ''
      list_token: listapprove
      object: loadvac.field_approve
    successors:
      -
        id: Activity_18rbrxi
        condition: ''
  Activity_00yaic9:
    plugin: 'eca_tamper:math'
    label: 'Add 1 to [countapprove]'
    configuration:
      operation: addition
      flip: false
      value: '1'
      eca_data: '[countapprove]'
      eca_token_name: countapprove
    successors:
      -
        id: Activity_045gvlj
        condition: ''
  Activity_1gykxij:
    plugin: eca_token_set_value
    label: 'Set 0 [countapprove]'
    configuration:
      token_name: countapprove
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Gateway_05pv8vu
        condition: ''
  Activity_0a8w5tr:
    plugin: eca_token_set_value
    label: 'Save first entity in [temp]'
    configuration:
      token_name: temp
      token_value: '[listapprove:0]'
      use_yaml: false
    successors:
      -
        id: Activity_194z4lz
        condition: ''
  Activity_04ut7x3:
    plugin: eca_token_set_value
    label: 'Set 0 [variable]'
    configuration:
      token_name: variable
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Activity_1gykxij
        condition: ''
  Activity_1ag8hw9:
    plugin: eca_list_remove_entity
    label: 'Drop first from [listapprove]'
    configuration:
      token_name: ''
      method: first
      index: ''
      list_token: listapprove
      object: ''
    successors:
      -
        id: Gateway_05pv8vu
        condition: ''
  Activity_045gvlj:
    plugin: 'eca_tamper:math'
    label: 'Add 1 to [variable]'
    configuration:
      operation: addition
      flip: false
      value: '1'
      eca_data: '[variable]'
      eca_token_name: variable
    successors:
      -
        id: Activity_1ag8hw9
        condition: ''
  Activity_194z4lz:
    plugin: eca_token_load_entity
    label: 'Load paragraph by Entity  ID [paragraph]'
    configuration:
      token_name: paragraph
      from: id
      entity_type: paragraph
      entity_id: '[temp]'
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Gateway_1sxe2lv
        condition: ''
  Activity_0kr7hwe:
    plugin: eca_set_field_value
    label: 'Set status [Approved]'
    configuration:
      field_name: '[field_state_vacation:value]'
      field_value: request_status_approved
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: loadvac
    successors:
      -
        id: Activity_1hn25e9
        condition: ''
  Activity_0ilmsz0:
    plugin: eca_token_set_value
    label: 'Set 0 [variable]'
    configuration:
      token_name: variable
      token_value: '0'
      use_yaml: false
    successors:
      -
        id: Activity_1efx5fc
        condition: ''
  Activity_0gmm4si:
    plugin: eca_token_set_value
    label: 'Save first entity in [temp]'
    configuration:
      token_name: temp
      token_value: '[listreject:0]'
      use_yaml: false
    successors:
      -
        id: Activity_0ia1e4u
        condition: ''
  Activity_0ia1e4u:
    plugin: eca_token_load_entity
    label: 'Load paragraph by Entity  ID [paragraph]'
    configuration:
      token_name: paragraph
      from: id
      entity_type: paragraph
      entity_id: '[temp]'
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1crxup1
        condition: ''
  Activity_0lz7bzs:
    plugin: eca_set_field_value
    label: 'Set user status [Rejected]'
    configuration:
      field_name: '[field_permission:value]'
      field_value: request_status_rejected
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: paragraph
    successors:
      -
        id: Activity_0zik2hi
        condition: ''
  Activity_1efx5fc:
    plugin: eca_set_field_value
    label: 'Set status [Rejected]'
    configuration:
      field_name: '[field_state_vacation:value]'
      field_value: request_status_rejected
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: loadvac
    successors:
      -
        id: Activity_1996w30
        condition: ''
  Activity_0zik2hi:
    plugin: 'eca_tamper:math'
    label: 'Add 1 to [variable]'
    configuration:
      operation: addition
      flip: false
      value: '1'
      eca_data: '[variable]'
      eca_token_name: variable
    successors:
      -
        id: Activity_0efx9ps
        condition: ''
  Activity_0efx9ps:
    plugin: eca_list_remove_entity
    label: 'Drop first from [listapprove]'
    configuration:
      token_name: ''
      method: first
      index: ''
      list_token: listreject
      object: ''
    successors:
      -
        id: Gateway_1vzq9rl
        condition: ''
  Activity_1crxup1:
    plugin: eca_token_set_value
    label: 'Get paragraph user [user]'
    configuration:
      token_name: user
      token_value: '[paragraph:field_person:target_id]'
      use_yaml: false
    successors:
      -
        id: Activity_1sq1tyx
        condition: ''
  Activity_1sq1tyx:
    plugin: eca_switch_account
    label: 'Switch user to [user]'
    configuration:
      user_id: '[user]'
    successors:
      -
        id: Activity_0lz7bzs
        condition: ''
  Activity_1hn25e9:
    plugin: eca_set_field_value
    label: 'Set status node [1]'
    configuration:
      field_name: '[status:value]'
      field_value: '1'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: loadvac
    successors:
      -
        id: Activity_0wjf3xb
        condition: Flow_18mpxzm
  Activity_1996w30:
    plugin: eca_list_add_entity
    label: 'Create list field_approve [listreject]'
    configuration:
      method: append
      index: ''
      list_token: listreject
      object: loadvac.field_approve
    successors:
      -
        id: Gateway_1vzq9rl
        condition: ''
  Activity_0shi393:
    plugin: action_message_action
    label: Activity_0shi393
    configuration:
      replace_tokens: false
      message: 'work - [b]'
    successors: {  }
  Activity_0wjf3xb:
    plugin: eca_views_query
    label: 'Load Balance'
    configuration:
      token_name: balance
      view_id: balance
      display_id: block_1
      arguments: ''
    successors:
      -
        id: Activity_0ou9s2n
        condition: ''
  Activity_0ou9s2n:
    plugin: 'eca_tamper:math'
    label: Activity_0ou9s2n
    configuration:
      operation: subtraction
      flip: false
      value: '[loadvac:field_numb_day:value]'
      eca_data: '[balance]'
      eca_token_name: b
    successors: {  }
